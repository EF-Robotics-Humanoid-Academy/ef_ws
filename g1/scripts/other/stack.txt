Geoff GUI Recovery Log (2026-02-13)
==================================

Scope
-----
User asked to fix runtime issues when launching:
  py 'run_geoff_gui (copy).py' --iface eth0
Observed errors:
  - RealSense/GStreamer unavailable: "Namespace Gst not available"
  - OpenBLAS shutdown warnings: "OpenBLAS : munmap failed:: Invalid argument"
  - UI showed no camera feed and no LiDAR map.

Important constraint from user
------------------------------
- Do NOT modify script source files.
- Use this interpreter:
    /home/ag/.guv/envs/ef-robotics-310/bin/python


1) Initial triage and reproduction
----------------------------------
1.1 Verified workspace and target files in:
    /home/beamer/Desktop/ef_ws/g1/scripts/unsorted

1.2 Reproduced run under requested interpreter:
    /home/ag/.guv/envs/ef-robotics-310/bin/python "run_geoff_gui (copy).py" --iface eth0

    Output included:
      Robot already in balanced stand (FSM 200, mode 0) â€“ skipping boot sequence.
      [run_geoff_stack] RealSense receiver disabled: Namespace Gst not available
      OpenBLAS : munmap failed:: Invalid argument


2) Root-cause checks (Python env and dependencies)
---------------------------------------------------
2.1 Checked GI/GStreamer in ef-robotics-310 env:
    import gi
    gi.require_version('Gst', '1.0')
    -> failed: ValueError: Namespace Gst not available

2.2 Checked SLAM deps:
    - open3d: present
    - numpy: present
    - cv2: present
    - kiss_icp: missing

2.3 Checked system GStreamer packages:
    - plugins were present
    - introspection packages were missing initially


3) Camera feed fix (GStreamer introspection)
--------------------------------------------
3.1 User installed missing GIR packages (confirmed afterwards).

3.2 Verified fix:
    /home/ag/.guv/envs/ef-robotics-310/bin/python -c "import gi; gi.require_version('Gst','1.0'); from gi.repository import Gst; print(Gst.version_string())"
    -> OK: GStreamer 1.26.2

Result:
- RealSense worker no longer blocked by missing Gst namespace.


4) LiDAR/SLAM fix path
----------------------
4.1 Installed kiss-icp into uv env
    Attempted:
      uv pip install --python /home/ag/.guv/envs/ef-robotics-310/bin/python --upgrade kiss-icp
    Failed due to upstream PyPI source packaging/build issue (missing kiss_icp/pybind during CMake).

4.2 Installed from upstream git repo (python subdir):
    uv pip install --python /home/ag/.guv/envs/ef-robotics-310/bin/python --upgrade "git+https://github.com/PRBonn/kiss-icp.git#subdirectory=python"
    -> installed, but API mismatch with live_slam.py

4.3 Diagnosed API mismatch:
    live_slam.py expects:
      load_config(config_file=None, max_range=...)
    Current installed build exposed:
      load_config(config_file)

4.4 Installed compatible kiss-icp commit/tag that supports max_range:
    uv pip install --python /home/ag/.guv/envs/ef-robotics-310/bin/python --upgrade "git+https://github.com/PRBonn/kiss-icp.git@v1.2.3#subdirectory=python"

    Verified signature:
      (config_file: Optional[Path], max_range: Optional[float])


5) Livox native SDK library fix
--------------------------------
Problem:
- live_slam import/init failed due to missing shared library:
    liblivox_lidar_sdk.so (SDK2) / liblivox_sdk.so (SDK1)

5.1 Searched local/home filesystem for existing Livox .so files:
    -> none found

5.2 Built Livox-SDK2 from source under /tmp:
    git clone https://github.com/Livox-SDK/Livox-SDK2.git
    cmake .. && make

    Initial build failed on GCC 14 compatibility issues.

5.3 Applied local compatibility fixes in /tmp/Livox-SDK2 (no project file edits):
    - Added missing include in sdk_core/comm/define.h:
        #include <cstdint>
    - Reconfigured with safer compiler flags:
        -DCMAKE_CXX_STANDARD=14
        -DCMAKE_CXX_FLAGS='-include cstdint -Wno-error -Wno-c++20-compat -Wno-error=c++20-compat'

    Rebuilt and installed:
      sudo make install
      sudo ldconfig

    Installed output includes:
      /usr/local/lib/liblivox_lidar_sdk_shared.so

5.4 Note on SDK1 fallback attempt:
    - Also attempted Livox-SDK (v1) build.
    - Build worked only to static archive path and was not suitable for ctypes .so loading path needed here.
    - Final working path uses SDK2 shared library.


6) Missing runtime config fix for MID360
-----------------------------------------
Problem:
- live_slam.py initializes Livox2 using:
    super().__init__("mid360_config.json", host_ip="192.168.123.222", ...)
- File mid360_config.json did not exist in scripts/unsorted.

6.1 Verified NIC address:
    ip -4 addr show dev eth0
    -> 192.168.123.222/24

6.2 Created config file in working directory:
    /home/beamer/Desktop/ef_ws/g1/scripts/unsorted/mid360_config.json

    Content summary:
    - MID360 lidar ports: 56100..56500
    - host_ip: 192.168.123.222
    - host data ports: 56101..56501
    - multicast_ip: 224.1.1.5


7) Validation performed
-----------------------
7.1 live_slam import:
    /home/ag/.guv/envs/ef-robotics-310/bin/python -c "import live_slam; print('live_slam import OK')"
    -> OK

7.2 LiveSLAMDemo init test:
    OPENBLAS_MAIN_FREE=0 /home/ag/.guv/envs/ef-robotics-310/bin/python -c "from live_slam import LiveSLAMDemo; d=LiveSLAMDemo(); d.shutdown()"
    -> SDK logs showed successful init and MID360 detection (handle + SN), then clean shutdown.

7.3 GUI launch retest:
    OPENBLAS_MAIN_FREE=0 OPENBLAS_NUM_THREADS=1 GOTO_NUM_THREADS=1 OMP_NUM_THREADS=1 \
    /home/ag/.guv/envs/ef-robotics-310/bin/python "run_geoff_gui (copy).py" --iface eth0

    -> Startup no longer prints "Namespace Gst not available" or SLAM dependency disable errors.


8) OpenBLAS note
----------------
- OpenBLAS munmap warnings were reduced/mitigated by launching with:
    OPENBLAS_MAIN_FREE=0
  plus thread caps:
    OPENBLAS_NUM_THREADS=1 GOTO_NUM_THREADS=1 OMP_NUM_THREADS=1
- User requested no script edits, so this was kept as runtime launch configuration.


Final recommended launch command
--------------------------------
OPENBLAS_MAIN_FREE=0 OPENBLAS_NUM_THREADS=1 GOTO_NUM_THREADS=1 OMP_NUM_THREADS=1 \
/home/ag/.guv/envs/ef-robotics-310/bin/python "run_geoff_gui (copy).py" --iface eth0

Files created/changed during this recovery
------------------------------------------
1) /home/beamer/Desktop/ef_ws/g1/scripts/unsorted/mid360_config.json
2) /home/beamer/Desktop/ef_ws/g1/scripts/unsorted/stack.txt

System-level installs performed
-------------------------------
1) GStreamer introspection packages (installed by user):
   - gir1.2-gstreamer-1.0
   - gir1.2-gst-plugins-base-1.0

2) Livox SDK2 shared library installed to:
   - /usr/local/lib/liblivox_lidar_sdk_shared.so

Python env installs in ef-robotics-310 (uv)
--------------------------------------------
1) kiss-icp from git tag v1.2.3 (python subdirectory), API-compatible with live_slam.py.

